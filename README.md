# 音乐治愈性分析工具 (Music Healing Analysis Tool)

这是一个基于Python的音乐治愈性分析工具，通过分析音乐的音程关系和声音粗糙度来评估音乐的治愈特性。该工具使用科学的音乐理论和声学原理，为音乐的治愈性提供量化评估。

## 功能特点

- 音程关系分析：分析音乐中的音程关系，计算音程亲和力分数
- 声音粗糙度分析：评估音乐的声音粗糙度
- 多线程处理：支持并行处理多个音频文件
- 可视化报告：生成详细的数据分析图表
- 支持多种音频格式：MP3, WAV, FLAC, M4A, OGG

## 安装要求

1. 确保已安装 Python 3.8 或更高版本
2. 安装依赖包：

```bash
bash
pip install -r requirements.txt


## 使用方法

1. 准备音频文件：
   - 在项目目录下创建两个文件夹：
     - `healing_music`：存放治愈音乐样本
     - `non_healing_music`：存放非治愈音乐样本

2. 运行分析：
```bash
python music_analysis.py [--base_path 音频文件路径]
```


## 评分系统说明

### 1. 音程亲和力分数计算

音程亲和力分数于传统音乐理论中的协和度理论，采用以下权重系统：

#### 完全协和音程（Perfect Consonances）
| 音程 | 半音数 | 权重 |
|------|--------|------|
| 纯一度 | 0 | 1.0 |
| 纯八度 | 12 | 1.0 |
| 纯五度 | 7 | 0.9 |
| 纯四度 | 5 | 0.8 |

#### 不完全协和音程（Imperfect Consonances）
| 音程 | 半音数 | 权重 |
|------|--------|------|
| 大三度 | 4 | 0.6 |
| 小三度 | 3 | 0.5 |
| 大六度 | 9 | 0.4 |
| 小六度 | 8 | 0.3 |

#### 不协和音程（Dissonances）
| 音程 | 半音数 | 权重 |
|------|--------|------|
| 大二度 | 2 | -0.2 |
| 小二度 | 1 | -0.4 |
| 增四度/减五度 | 6 | -0.6 |
| 小七度 | 10 | -0.3 |
| 大七度 | 11 | -0.5 |

音程亲和力分数计算过程：
1. 提取音频的音高序列
2. 计算相邻音符之间的音程
3. 根据上述权重表计算每个音程的权重
4. 计算平均权重并归一化到0-1范围

### 2. 粗糙度分数计算

粗糙度分析实际上是通过多个声学特征的综合评估来衡量音乐的平滑度（而不是传统意义上的粗糙度）。

#### 计算过程：

1. 声谱特征提取
   - 使用 librosa 库加载音频（采样前30秒）
   - 计算频谱质心（spectral centroid）
   - 计算频谱带宽（spectral bandwidth）
   - 分离谐波和打击乐成分（HPSS分离）
   - 提取色谱图特征（chroma features）

2. 特征计算与权重分配
   - 谐波比率（40%权重）：
     * 计算谐波能量与打击乐能量的比值
     * 较高的谐波比率表示音乐更加和谐
   
   - 频谱质心得分（20%权重）：
     * 评估高频成分的影响
     * 得分 = 1 - (频谱质心平均值 / (采样率/4))
   
   - 频谱带宽得分（20%权重）：
     * 评估频率分布的集中度
     * 得分 = 1 - (频谱带宽平均值 / (采样率/4))
   
   - 音高稳定性得分（20%权重）：
     * 基于色谱图特征的变化程度
     * 得分 = 1 - min(色谱方差, 1)

3. 最终得分计算
   - 将四个特征得分按权重组合
   - 使用 sigmoid 函数（k=8）进行非线性映射
   - 结果限制在 0-1 范围内

#### 评分标准：

| 得分范围 | 音乐特征 | 对治愈性的影响 |
|---------|---------|--------------|
| 0.8-1.0 | 高度和谐、稳定、平滑 | 非常有利 |
| 0.6-0.8 | 和谐、较为稳定 | 较为有利 |
| 0.4-0.6 | 中等和谐度 | 中性 |
| 0.2-0.4 | 不够和谐、波动较大 | 较为不利 |
| 0.0-0.2 | 不和谐、不稳定 | 非常不利 |

#### 影响因素：

1. 谐波性
   - 谐波成分越多，得分越高
   - 打击乐成分越少，得分越高

2. 频率特征
   - 较低的频谱质心有利于得分
   - 适中的频谱带宽有利于得分

3. 音高稳定性
   - 音高变化越平稳，得分越高
   - 避免剧烈的音高波动

#### 在治愈音乐中的应用：

- 治愈音乐通常具有较高的得分（0.6-1.0）
- 特点：
  * 谐波丰富，打击乐节制
  * 频率分布适中，避免过多高频
  * 音高变化平缓，旋律流畅
  * 整体声音和谐稳定

最终得分计算：
- 综合得分 = 0.7 × 音程亲和力分数 + 0.3 × 粗糙度分数，但是综合得分不会用可视化显示，只会在excel中显示

## 输出结果

程序会生成以下输出：
1. `analysis_results.xlsx`：详细的分析数据
2. `score_distribution.png`：音程亲和力分数分布图
3. `roughness_distribution.png`：粗糙度分数分布图

## 注意事项

- 建议使用时长30秒以上的音频样本
- 音频文件应具有良好的录音质量
- 程序支持中断处理（Ctrl+C）和安全退出机制

## 许可证

MIT License

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目。

## 作者

[Xiong hr]

## 致谢

感谢所有为这个项目提供建议和帮助的贡献者。


